<!doctype html><html>
<head>
<title>Apache Spark Architecture</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="ie=edge">
<link rel=stylesheet href=/css/bootstrap.min.css>
<link rel=stylesheet href=/css/layouts/main.css>
<link rel=stylesheet href=/css/navigators/navbar.css>
<link rel=stylesheet href=/css/plyr.css>
<link rel=stylesheet href=/css/flag-icon.min.css>
<link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600">
<link rel=stylesheet href=/fontawesome/css/all.min.css>
<link rel=stylesheet href=/css/colortheme/colortheme.css>
<meta property="og:title" content="Apache Spark Architecture">
<meta property="og:description" content="Unified Computing engine and set of libraries for parallel data processing on compute cluster. Supports multiple programming languages, Python, Scala, Java and R. Unified  Supports wide range of data analytics tasks on same compute engine Provides consistent and composable API. Makes it easy and efficient to develop applications Enables high performance by optimizing across different libraries and functions.   Compute Engine  Supports wide range of storage systems Limits scope to compute engine and not the end storage Data already resides in many systems and moving data to another system is an expensive operation.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://vivekparadkar.github.io/posts/apache-spark/architecture/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-09-11T00:00:00+00:00">
<meta property="article:modified_time" content="2022-09-11T00:00:00+00:00">
<meta name=description content="Apache Spark Architecture">
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css>
<link rel=stylesheet href=/css/layouts/single.css>
<link rel=stylesheet href=/css/navigators/sidebar.css>
<link rel=stylesheet href=/css/style.css>
</head>
<body data-spy=scroll data-target=#TableOfContents data-offset=80>
<div class="container-fluid bg-dimmed wrapper">
<nav class="navbar navbar-expand-xl top-navbar final-navbar shadow">
<div class=container>
<button class="navbar-toggler navbar-light" id=sidebar-toggler type=button onclick=toggleSidebar()>
<span class=navbar-toggler-icon></span>
</button>
<a class=navbar-brand href=/>
Vivek Paradkar's Blog</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button onclick=toggleTOC()>
<span class=navbar-toggler-icon></span>
</button>
<div class="collapse navbar-collapse lang-selector" id=top-nav-items>
<ul class="navbar-nav ml-auto">
<li class="nav-item dropdown">
<div id=theme-initialization style=display:none default-theme=system></div>
<a class="nav-link dropdown-toggle" href=# id=themeSelector role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>
<img id=navbar-theme-icon-svg src=/icons/moon-svgrepo-com.svg width=20>
</a>
<div class="dropdown-menu dropdown-menu-icons-only" aria-labelledby=themeSelector>
<a class="dropdown-item nav-link" href=# onclick=enableLightTheme()>
<img class=menu-icon-center src=/icons/sun-svgrepo-com.svg width=20>
</a>
<a class="dropdown-item nav-link" href=# onclick=enableDarkTheme()>
<img class=menu-icon-center src=/icons/moon-svgrepo-com.svg width=20>
</a>
<a class="dropdown-item nav-link" href=# onclick=useSystemTheme()>
<img class=menu-icon-center src=/icons/computer-svgrepo-com.svg width=20>
</a>
</div>
</li>
</ul>
</div>
</div>
</nav>
<section class=sidebar-section id=sidebar-section>
<div class=sidebar-holder>
<div class=sidebar id=sidebar>
<form class=mx-auto method=get action=/search>
<input type=text name=keyword placeholder=Search data-search id=search-box>
</form>
<div class=sidebar-tree>
<ul class=tree id=tree>
<li id=list-heading><a href=/posts data-filter=all>Posts</a></li>
<div class=subtree>
<li>
<i class="fas fa-minus-circle"></i><a class=active href=/posts/apache-spark/>Apache Spark</a>
<ul class=active>
<li><a class=active href=/posts/apache-spark/architecture/ title="Apache Spark Architecture">Apache Spark Architecture</a></li>
<li><a href=/posts/apache-spark/structured-api/ title="Structured API">Structured API</a></li>
</ul>
</li>
<li>
<i class="fas fa-plus-circle"></i><a href=/posts/azure/>Azure</a>
<ul>
<li><a href=/posts/azure/storage/ title="Azure Storage">Azure Storage</a></li>
</ul>
</li>
</div>
</ul>
</div>
</div>
</div>
</section>
<section class=content-section id=content-section>
<div class=content>
<div class="container p-0 read-area">
<div class="hero-area col-sm-12" id=hero-area style=background-image:url(/images/default-hero.jpg)>
</div>
<div class=page-content>
<div class="author-profile ml-auto align-self-lg-center">
<img class=rounded-circle src=/images/author/vivek_hu1d437a61875053bae941f5f0700ceede_423200_120x120_fit_q75_box.jpg alt="Author Image">
<h5 class=author-name>Vivek Paradkar</h5>
<p>Sunday, September 11, 2022</p>
</div>
<div class=title>
<h1>Apache Spark Architecture</h1>
</div>
<div class=post-content id=post-content>
<ul>
<li>Unified Computing engine and set of libraries for parallel data processing on compute cluster.</li>
<li>Supports multiple programming languages, Python, Scala, Java and R.</li>
<li><strong>Unified</strong>
<ul>
<li>Supports wide range of data analytics tasks on same compute engine</li>
<li>Provides consistent and composable API.</li>
<li>Makes it easy and efficient to develop applications</li>
<li>Enables high performance by optimizing across different libraries and functions.</li>
</ul>
</li>
<li><strong>Compute Engine</strong>
<ul>
<li>Supports wide range of storage systems</li>
<li>Limits scope to compute engine and not the end storage</li>
<li>Data already resides in many systems and moving data to another system is an expensive operation. Spark supports loading data from multiple storage systems and perform computation.</li>
</ul>
</li>
<li><strong>Libraries</strong>: Includes libraries for:
<ul>
<li>SQL and structured data (SparkSQL)</li>
<li>Machine learning (Mllib)</li>
<li>Streaming (Spark streaming and structured streaming)</li>
<li>Graph analytics (GraphX)</li>
</ul>
</li>
</ul>
<h2 id=spark-architecture>Spark Architecture</h2>
<hr>
<ul>
<li>Single node does not have enough resources to process high volume of data.</li>
<li>To process BigData you need a cluster of nodes that pool all the available resources.</li>
<li>To perform computation on cluster of nodes, we require two components:
<ul>
<li>Framework to manage tasks across cluster, this is done by Apache Spark.</li>
<li>Framework to manage the nodes in the cluster also called a <strong>Cluster Manager</strong>. Apache spark supports following cluster manager:
<ul>
<li>Spark Standalone cluster</li>
<li>YARN</li>
<li>Kubernete</li>
<li>Mesos</li>
</ul>
</li>
</ul>
</li>
<li>To perform compuation on cluster, we have to develop and submit a Spark application (using <code>spark-submit</code>)</li>
</ul>
<h4 id=spark-application>Spark Application</h4>
<ul>
<li>Application is a user program developed using Spark APIs.</li>
<li>It consists of a <a href=#spark-driver-process>Driver Process</a> and <a href=#spark-executors>executors</a>.</li>
<li>Let&rsquo;s look at a simple Spark application, that finds Top 5 customers with highest order amount.</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>import</span> sys

<span style=color:#f92672>from</span> pyspark.sql <span style=color:#f92672>import</span> SparkSession
<span style=color:#f92672>import</span> pyspark.sql.functions <span style=color:#66d9ef>as</span> f

<span style=color:#66d9ef>if</span> len(sys<span style=color:#f92672>.</span>argv) <span style=color:#f92672>!=</span> <span style=color:#ae81ff>2</span>:
  print(<span style=color:#e6db74>&#39;Usage: sum_multiple.py &lt;end_number&gt;&#39;</span>)
  sys<span style=color:#f92672>.</span>exit(<span style=color:#ae81ff>1</span>)

retail_file <span style=color:#f92672>=</span> sys<span style=color:#f92672>.</span>argv[<span style=color:#ae81ff>1</span>]

spark <span style=color:#f92672>=</span> SparkSession \
        <span style=color:#f92672>.</span>builder \
        <span style=color:#f92672>.</span>appName(<span style=color:#e6db74>&#34;Sum Multiples of 3, 5 or 7&#34;</span>) \
        <span style=color:#f92672>.</span>getOrCreate()

retail_df <span style=color:#f92672>=</span> spark<span style=color:#f92672>.</span>read<span style=color:#f92672>.</span>format(<span style=color:#e6db74>&#34;csv&#34;</span>) \
            <span style=color:#f92672>.</span>option(<span style=color:#e6db74>&#34;header&#34;</span>, <span style=color:#e6db74>&#34;true&#34;</span>) \
            <span style=color:#f92672>.</span>option(<span style=color:#e6db74>&#34;inferSchema&#34;</span>, <span style=color:#e6db74>&#34;true&#34;</span>) \
            <span style=color:#f92672>.</span>load(retail_file)

top_orders_df <span style=color:#f92672>=</span> retail_df \
                <span style=color:#f92672>.</span>withColumn(<span style=color:#e6db74>&#34;OrderAmount&#34;</span>, f<span style=color:#f92672>.</span>expr(<span style=color:#e6db74>&#34;Quantityt * UnitPrice&#34;</span>)) \
                <span style=color:#f92672>.</span>select(<span style=color:#e6db74>&#34;CustomerID&#34;</span>, <span style=color:#e6db74>&#34;OrderAmount&#34;</span>) \
                <span style=color:#f92672>.</span>where(<span style=color:#e6db74>&#34;CustomerID is not null&#34;</span>) \
                <span style=color:#f92672>.</span>groupBy(<span style=color:#e6db74>&#34;CustomerID&#34;</span>) \
                <span style=color:#f92672>.</span>agg(f<span style=color:#f92672>.</span>sum(<span style=color:#e6db74>&#34;OrderAmount&#34;</span>)<span style=color:#f92672>.</span>alias(<span style=color:#e6db74>&#34;TotalOrderAmount&#34;</span>)) \
                <span style=color:#f92672>.</span>orderBy(<span style=color:#e6db74>&#34;TotalOrderAmount&#34;</span>, ascending <span style=color:#f92672>=</span> <span style=color:#66d9ef>False</span>) \
                <span style=color:#f92672>.</span>limit(<span style=color:#ae81ff>5</span>)

print(top_orders_df<span style=color:#f92672>.</span>collect())
</code></pre></div><p><strong>Submit Spark Application</strong></p>
<p>Submit spark application using below command:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>spark-submit top_customers.py /databricks-datasets/online_retail/data-001/data.csv
</code></pre></div><p>Following happens when we submit application using spark-submit:</p>
<ul>
<li>requests cluster manager to allocate resources for the <strong><a href=#spark-driver-process>Spark Driver process</a></strong></li>
<li>Cluster manager acknowledges the request and places driver process on a node in the cluster</li>
<li>the local process exits and application starts running on the cluster</li>
</ul>
<h6 id=spark-driver-process>Spark Driver Process</h6>
<p>Driver process runs the user program and performs following functions:</p>
<ul>
<li>Maintains the state of spark application</li>
<li>Responds to user program or input</li>
<li>Analyzes, Distributes and schedules tasks on the executors</li>
</ul>
<p>Driver process initializes SparkSession which communicates with cluster manager to launch executor processes. Cluster manager launches executor processes and sends the information back to Spark Session.</p>
<h6 id=spark-executors>Spark Executors</h6>
<p>Spark Executors perform following functions:</p>
<ul>
<li>Run tasks assigned by the Driver process.</li>
<li>Return the status to Driver process.</li>
</ul>
<p><a href=https://medium.com/datalex/sparks-logical-and-physical-plans-when-why-how-and-beyond-8cd1947b605a>https://medium.com/datalex/sparks-logical-and-physical-plans-when-why-how-and-beyond-8cd1947b605a</a></p>
</div>
<div class="row pl-3 pr-3">
<div class="col-md-6 share-buttons">
</div>
<div class="col-md-6 btn-improve-page">
<a href=https://github.com/vivekparadkar/vivekparadkar.github.io/edit/main/content/posts/apache-spark/architecture/index.md title="Improve this page" target=_blank rel=noopener>
<i class="fas fa-code-branch"></i>
Improve this page
</a>
</div>
</div>
<hr>
<div class="row next-prev-navigator">
<div class="col-md-12 next-article">
<a href=/posts/apache-spark/structured-api/ title="Structured API" class="btn btn-outline-info">
<div>Next <i class="fas fa-chevron-circle-right"></i></div>
<div class=next-prev-text>Structured API</div>
</a>
</div>
</div>
<hr>
</div>
</div>
</div>
<a id=scroll-to-top class=btn><i class="fas fa-chevron-circle-up"></i></a>
</section>
<section class=toc-section id=toc-section>
<div class=toc-holder>
<h5 class="text-center pl-3">Table of Contents</h5>
<hr>
<div class=toc>
<nav id=TableOfContents>
<ul>
<li><a href=#spark-architecture>Spark Architecture</a>
<ul>
<li>
<ul>
<li><a href=#spark-application>Spark Application</a>
<ul>
<li>
<ul>
<li><a href=#spark-driver-process>Spark Driver Process</a></li>
<li><a href=#spark-executors>Spark Executors</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</div>
</div>
</section>
</div>
<footer id=footer class="container-fluid text-center align-content-center footer pb-2">
<div class="container pt-5">
<div class="row text-left">
<div class="col-md-4 col-sm-12">
<h5>Navigation</h5>
<ul>
<li class=nav-item>
<a class=smooth-scroll href=https://vivekparadkar.github.io/#about>About</a>
</li>
<li class=nav-item>
<a class=smooth-scroll href=https://vivekparadkar.github.io/#skills>Skills</a>
</li>
<li class=nav-item>
<a class=smooth-scroll href=https://vivekparadkar.github.io/#experiences>Experiences</a>
</li>
</ul>
</div>
<div class="col-md-4 col-sm-12">
<h5>Contact me:</h5>
<ul>
<li><a href=mailto:vivekparadkar@gmail.com target=_blank rel=noopener>
<span><i class="fas fa-envelope"></i></span> <span>vivekparadkar@gmail.com</span>
</a></li>
</ul>
</div>
</div>
</div>
<hr>
<div class=container>
<div class="row text-left">
<div class=col-md-4>
<a id=theme href=https://github.com/hossainemruz/toha target=_blank rel=noopener>
<img src=/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_3.png alt="Toha Theme Logo">
Toha
</a>
</div>
<div class="col-md-4 text-center">© 2022 Copyright.</div>
<div class="col-md-4 text-right">
<a id=hugo href=https://gohugo.io/ target=_blank rel=noopener>Powered by
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18>
</a>
</div>
</div>
</div>
</footer>
<script type=text/javascript src=/js/jquery-3.4.1.min.js></script>
<script type=text/javascript src=/js/popper.min.js></script>
<script type=text/javascript src=/js/bootstrap.min.js></script>
<script type=text/javascript src=/js/navbar.js></script>
<script type=text/javascript src=/js/plyr.js></script>
<script type=text/javascript src=/js/main.js></script>
<script type=text/javascript src=/js/darkreader.js></script>
<script type=text/javascript src=/js/darkmode-darkreader.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js></script>
<script src=/js/single.js></script>
<script>hljs.initHighlightingOnLoad()</script>
</body>
</html>